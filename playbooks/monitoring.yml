---
- name: Deploy monitoring stack to K3s cluster
  hosts: server[0]
  gather_facts: true
  become: true
  vars:
    # Override default kubeconfig path if needed
    kubeconfig_path: "/etc/rancher/k3s/k3s.yaml"
  roles:
    - role: monitoring

  post_tasks:
    - name: Display monitoring access information
      debug:
        msg: |
          ğŸš€ Monitoring Stack Deployment Complete! ğŸš€

          ğŸ“Š Grafana Dashboard: http://{{ ansible_default_ipv4.address }}:30001
             Username: admin
             Password: admin

          ğŸ“ˆ Prometheus UI: http://{{ ansible_default_ipv4.address }}:30000

          ğŸ” What's included:
          â€¢ Prometheus - Metrics collection and alerting
          â€¢ Grafana - Beautiful dashboards and visualization
          â€¢ Loki - Log aggregation and search
          â€¢ Promtail - Automatic log collection from all pods
          â€¢ Node Exporter - System-level metrics
          â€¢ Kube State Metrics - Kubernetes cluster state

          ğŸ’¡ Next Steps:
          1. Access Grafana and explore the pre-configured K8s dashboard
          2. Import additional dashboards from grafana.com
          3. Set up alerting channels (email, Slack, Discord, etc.)
          4. Configure log queries in Grafana using Loki data source

          ğŸ“š Useful Grafana Dashboard IDs to import:
          â€¢ 12119 - Kubernetes Cluster Overview
          â€¢ 315 - Kubernetes Cluster Monitoring
          â€¢ 13332 - Kube State Metrics v2
          â€¢ 1860 - Node Exporter Full
